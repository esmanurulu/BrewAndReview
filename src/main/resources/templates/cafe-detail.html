<!DOCTYPE html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Kafe DetayÄ± - Brew&Review</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #3e2723; color: #fcf6f0; font-family: 'Poppins', sans-serif; padding: 0; margin: 0; overflow-x: hidden; }
        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; padding-bottom: 100px; }
        .profile-icon-container { position: fixed; top: 20px; left: 20px; z-index: 1000; transition: transform 0.8s; }
        .profile-icon-container img { width: 60px; height: 60px; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.5)); }
        .profile-icon-container:hover { transform: scale(1.2) rotate(720deg); cursor: pointer; }
        .btn-back { display: inline-block; margin-bottom: 20px; background: rgba(255, 255, 255, 0.1); color: #d7ccc8; padding: 8px 20px; border-radius: 30px; text-decoration: none; border: 1px solid #8d6e63; transition: 0.3s; font-size: 0.9rem;}
        .btn-back:hover { background: #ffca28; color: #3e2723; border-color: #ffca28; }
        .cafe-header { background: #5d4037; padding: 40px; border-radius: 25px; text-align: center; border: 2px solid #8d6e63; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        h1 { margin: 0; color: #ffca28; font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .info { font-size: 1.2rem; margin-top: 15px; opacity: 0.9; display: flex; justify-content: center; align-items: center; gap: 10px;}
        .action-buttons { text-align: center; margin: 30px 0; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .btn-review { background: #ffca28; color: #3e2723; padding: 15px 35px; border-radius: 30px; font-weight: bold; text-decoration: none; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(255, 202, 40, 0.4); transition: 0.3s; border: none; cursor: pointer; }
        .btn-review:hover { transform: scale(1.05); background: #ffb300; }
        .btn-checkin { background: #8d6e63; color: white; padding: 15px 35px; border-radius: 30px; font-weight: bold; font-size: 1.1rem; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(141, 110, 99, 0.4); transition: 0.3s; }
        .btn-checkin:hover { transform: scale(1.05); background: #a1887f; }
        .btn-fav { background: transparent; border: 2px solid #ef5350; color: #ef5350; padding: 15px 30px; border-radius: 30px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1.1rem; }
        .btn-fav:hover { background: rgba(239, 83, 80, 0.1); }
        .btn-fav.active { background: #ef5350; color: white; }
        .btn-disabled { background: #5d4037; color: #9e9e9e; padding: 15px 30px; border-radius: 30px; border: 1px solid #795548; cursor: not-allowed; font-size: 1.1rem; font-weight: bold; }
        .section-title { margin-top: 50px; border-bottom: 2px solid #8d6e63; padding-bottom: 10px; color: #ffcc80; font-size: 1.6rem; }
        .list-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .item-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; transition: 0.3s; border: 1px solid transparent; display: flex; flex-direction: column; justify-content: center; }
        .item-card:hover { background: rgba(255,255,255,0.1); border-color: #8d6e63; transform: translateY(-3px);}
        .price { float: right; font-weight: bold; color: #ffca28; }
        .role-badge { background: #8d6e63; padding: 4px 10px; border-radius: 10px; font-size: 0.8rem; display: inline-block; margin-top: 5px; }
        .review-card { background: rgba(0,0,0,0.2); padding: 25px; border-radius: 15px; margin-bottom: 20px; border-left: 5px solid #ffca28; }
        .user-link { color: #ffca28; text-decoration: none; font-weight: bold; transition: 0.3s; }
        .user-link:hover { text-decoration: underline; color: #fff; }
    </style>
</head>
<body>

    <a href="/profile" class="profile-icon-container" title="Profilime Git">
        <img th:src="@{/images/bean.png}" alt="Profil">
    </a>

    <div class="container">
        <a href="/cafes" class="btn-back">â† Listeye DÃ¶n</a>

        <div class="cafe-header">
            <h1 th:text="${cafe.name}">Kafe AdÄ±</h1>
            <div class="info">
                <span>ğŸ“ <span th:text="${cafe.city}">Åehir</span></span>
                <span style="opacity: 0.5;">|</span>
                <span th:if="${cafe.totalRating != null}" style="color: #ffca28; font-weight: bold; display: flex; align-items: center; gap: 5px;">
                    <img th:src="@{/images/bean.png}" width="24">
                    <span th:text="${cafe.totalRating}">4.5</span>
                </span>
                <span th:if="${cafe.totalRating == null}" style="opacity: 0.7; font-style: italic; font-size: 0.9rem;">(HenÃ¼z PuanlanmadÄ±)</span>
            </div>
            
            <div style="margin-top: 20px; font-size: 1rem; color: #efebe9; background: rgba(0,0,0,0.2); display: inline-block; padding: 15px 30px; border-radius: 15px; text-align:left;">
                <div style="margin-bottom: 8px;">ğŸ“ <span th:text="${cafe.phoneNumber} ?: 'Numara BelirtilmemiÅŸ'"></span></div>
                <div>
                    â° <span th:text="${cafe.openingHours} ?: 'BelirtilmemiÅŸ'"></span>
                    <span th:if="${cafe.openingHours != null}">
                        <span th:if="${cafe.isOpenNow()}" style="background: #66bb6a; color: white; padding: 3px 10px; border-radius: 5px; font-size: 0.85rem; margin-left: 10px; font-weight: bold;">AÃ‡IK âœ…</span>
                        <span th:unless="${cafe.isOpenNow()}" style="background: #ef5350; color: white; padding: 3px 10px; border-radius: 5px; font-size: 0.85rem; margin-left: 10px; font-weight: bold;">KAPALI âŒ</span>
                    </span>
                </div>
            </div>
            
            <div style="margin-top: 15px; font-size: 0.9rem; color: #76ff03; border:1px dashed #76ff03; display: inline-block; padding: 8px 20px; border-radius: 15px;">
                ğŸš€ En YoÄŸun: <span th:text="${busiestTime}">Veri Yok</span>
            </div>

            <p th:text="${cafe.address}" style="font-size: 1rem; color: #d7ccc8; margin-top: 20px;">AÃ§Ä±k Adres</p>
        </div>

        <div class="action-buttons">
            <form th:action="@{/cafe/{id}/favorite(id=${cafe.cafeId})}" method="post">
                <button type="submit" class="btn-fav" th:classappend="${isFavorite} ? 'active' : ''"><span th:text="${isFavorite} ? 'â¤ï¸ Favorilerimde' : 'ğŸ¤ Favorile'">Favorile</span></button>
            </form>
            <a th:if="${visited}" th:href="@{/cafe/{id}/review(id=${cafe.cafeId})}" class="btn-review">âœï¸ DeÄŸerlendir</a>
            <button th:if="${!visited}" class="btn-disabled" onclick="alert('Yorum yapabilmek iÃ§in Ã¶nce Check-in yapmalÄ±sÄ±n! ğŸ“')">ğŸ”’ Ã–nce Ziyaret Et</button>
            <form th:action="@{/cafe/{id}/visit(id=${cafe.cafeId})}" method="post">
                <button type="submit" class="btn-checkin">ğŸ“ BuradaydÄ±m</button>
            </form>
        </div>
        <div th:if="${successMessage}" style="background-color: #4caf50; color: white; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 20px; font-weight: bold;"><span th:text="${successMessage}"></span></div>

        <h2 class="section-title">ğŸ’¬ Son DeÄŸerlendirmeler</h2>
        <div th:if="${#lists.isEmpty(reviews)}" style="text-align: center; padding: 30px; opacity: 0.7; border: 2px dashed #5d4037; border-radius: 15px;"><p>HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ.</p></div>
        <div class="reviews-list">
            <div class="review-card" th:each="review : ${reviews}">
                <div style="display:flex; justify-content:space-between; align-items: center;">
                    <a th:href="@{/user/{username}(username=${review.user.username})}" class="user-link"><strong th:text="${review.user.username}" style="font-size: 1.1rem;">KullanÄ±cÄ±</strong></a>
                    <span style="color:#ffca28; font-weight: bold; font-size: 1.1rem;" th:text="'â˜… ' + ${review.ratingOverall}">5.0</span>
                </div>
                <div th:if="${not #lists.isEmpty(review.consumedItems)}" style="font-size:0.9rem; color:#d7ccc8; margin:10px 0; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 8px;"><span>ğŸ½ï¸ DenediÄŸi Lezzetler: </span><span th:each="item : ${review.consumedItems}" th:text="${item.name} + ', '" style="font-style: italic;"></span></div>
                <p style="margin-top:15px;" th:text="${review.comment}">Yorum...</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;"><small style="opacity:0.5;" th:text="${#dates.format(review.reviewDate, 'dd MMMM yyyy')}">Tarih</small><form th:action="@{/review/{id}/helpful(id=${review.reviewId})}" method="post"><button type="submit" style="background: transparent; border: 1px solid #8d6e63; color: #d7ccc8; padding: 5px 12px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; gap: 5px;">ğŸ‘ FaydalÄ± <span style="background: #ffca28; color: #3e2723; padding: 1px 6px; border-radius: 50%; font-size: 0.75rem; font-weight: bold;" th:text="${review.helpfulCount} ?: 0">0</span></button></form></div>
            </div>
        </div>

        <h2 class="section-title">ğŸ“œ MenÃ¼</h2>
        <div class="list-grid">
            <div class="item-card" th:each="menuItem : ${cafe.menuItems}">
                <strong th:text="${menuItem.name}" style="font-size: 1.1rem;">Kahve</strong>
                <span class="price" th:text="${menuItem.price} + ' â‚º'">00 â‚º</span>
                <p style="font-size: 0.9rem; opacity: 0.7;" th:text="${menuItem.description}">AÃ§Ä±klama</p>
            </div>
        </div>
        
        <h2 class="section-title">ğŸ‘¨â€ğŸ³ Baristalar & Ekip</h2>
        <div th:if="${#lists.isEmpty(cafe.employees)}" style="opacity: 0.6; font-style: italic;">Bu kafenin Ã§alÄ±ÅŸan bilgisi girilmemiÅŸ.</div>
        <div class="list-grid">
            <div class="item-card" th:each="employee : ${cafe.employees}">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                    <span style="font-size: 1.5rem;">â˜•ï¸</span>
                    
                    <a th:if="${employee.username != null}" th:href="@{/user/{username}(username=${employee.username})}" class="user-link">
                        <strong th:text="${employee.name}" style="font-size: 1.1rem; color: #fcf6f0;">Ã‡alÄ±ÅŸan AdÄ±</strong>
                    </a>
                    <strong th:if="${employee.username == null}" th:text="${employee.name}" style="font-size: 1.1rem; color: #fcf6f0; opacity: 0.8;">Ã‡alÄ±ÅŸan AdÄ±</strong>

                </div>
                <div><span class="role-badge" th:text="${#strings.capitalize(employee.role)}">Barista</span><span style="font-size: 0.85rem; margin-left: 5px; opacity: 0.8; color: #d7ccc8;">(<span th:text="${employee.experienceYears}">2</span> YÄ±l)</span></div>
                
                <div style="margin-top: 10px;" th:if="${employee.username != null}">
                    <form th:action="@{/follow/employee/{id}(id=${employee.employeeId})}" method="post">
                        <button type="submit" th:if="${#lists.contains(followedEmployeeIds, employee.employeeId)}" style="background: #66bb6a; color: white; border: none; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; width: 100%;">âœ… Takip Ediliyor</button>
                        <button type="submit" th:unless="${#lists.contains(followedEmployeeIds, employee.employeeId)}" style="background: transparent; border: 1px solid #a1887f; color: #d7ccc8; padding: 5px 15px; border-radius: 20px; cursor: pointer; width: 100%; transition:0.3s;">ğŸ‘¤ Takip Et</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
